# Configuration file to unpack CSC digis, run Trigger Primitives emulator,
# and compare LCTs in the data with LCTs found by the emulator.
# Slava Valuev; October, 2006.

process CSCTPEmulator = {

    untracked PSet maxEvents = {untracked int32 input = 1000}

#    source = NewEventStreamFileReader {
##	string fileName = "file:/tmp/slava/mtcc.00002571.A.testStorageManager_0.0.dat"
#	untracked vstring fileNames = {
##	    "file:/tmp/slava/mtcc.00003797.A.testStorageManager_0.0.dat"
##	    "file:/tmp/slava/mtcc.00003999.A.testStorageManager_0.0.dat"
##	    "file:/tmp/slava/mtcc.00004022.A.testStorageManager_0.0.dat"
##	    "file:/tmp/slava/mtcc.00004062.A.testStorageManager_0.0.dat"
#	    "file:/tmp/slava/mtcc.00004138.A.testStorageManager_0.0.dat"
#	}
#        int32 max_event_size = 7000000
#        int32 max_queue_depth = 5
#    }

    #include "L1Trigger/CSCTriggerPrimitives/test/run39924.cfi"
    #include "L1Trigger/CSCTriggerPrimitives/test/run080428_164658.cfi"
    #include "L1Trigger/CSCTriggerPrimitives/test/run080515_095949.cfi"
    #include "L1Trigger/CSCTriggerPrimitives/test/run080528_190406.cfi"
    include "L1Trigger/CSCTriggerPrimitives/test/run080609_103605.cfi"

#    source = PoolSource {
#	untracked vstring fileNames = {"file:/data0/slava/data/csc_00014419.root"}
#        untracked uint32 debugVebosity = 10
#        untracked bool   debugFlag     = false
##	untracked uint32 skipEvents    = 2370
#    }

#    include "L1Trigger/CSCTriggerPrimitives/test/run43434.cfi"

# es_source of ideal geometry
# ===========================
# endcap muon only...
    include "Geometry/MuonCommonData/data/muonEndcapIdealGeometryXML.cfi"

# Needed according to Mike Case's e-mail from 27/03.
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

# flags for modelling of CSC geometry
# ===================================
    include "Geometry/CSCGeometry/data/cscGeometry.cfi"

# magnetic field (do I need it?)
# ==============================
    include "Configuration/StandardSequences/data/MagneticField.cff"

    service = MessageLogger {
	untracked vstring destinations = {"debug"}
	untracked PSet debug = {
	    untracked string extension = ".txt"
	    untracked string threshold = "DEBUG"
#	    untracked string threshold = "WARNING"
	    untracked int32 lineLength = 132
	    untracked bool noLineBreaks = true
	} 
#        untracked vstring debugModules = {  "*"  }
	untracked vstring debugModules = { "cscTriggerPrimitiveDigis", "lctreader" }
    }

# Cabling map
# ===========
    include "EventFilter/CSCRawToDigi/data/cscFrontierCablingUnpck.cff"

# CSC raw --> digi unpacker
# =========================
    module cscunpacker = CSCDCCUnpacker {
        untracked bool Debug = false
        untracked bool PrintEventNumber = false
        untracked bool UseExaminer = true
#        untracked uint32 ExaminerMask = 0x7FF7BF6
 	untracked uint32 ExaminerMask = 0x1FEBF3F6
	untracked bool UnpackStatusDigis = false
	# for run 566 and 2008 data
	untracked uint32 ErrorMask=0x0
#        untracked uint32 ErrorMask = 0xDFCFEFFF
	untracked bool UseSelectiveUnpacking = true
	# Define input to the unpacker
	#InputTag InputObjects = cscpacker:CSCRawData
	InputTag InputObjects = source
	# MTCC data flag
	untracked bool isMTCCData = false
    }

# CSC Trigger Primitives configuration
# ====================================
    include "L1TriggerConfig/L1CSCTPConfigProducers/data/L1CSCTriggerPrimitivesConfig.cff"
    ## replace l1csctpconf.isMTCC = true # MTCC version
    # replace l1csctpconf.isTMB07 = true # TMB07 firmware version
    # replace l1csctpconf.alctParamMTCC2.alctDriftDelay = 2
    # replace l1csctpconf.alctParamMTCC2.alctL1aWindow  = 7

# CSC Trigger Primitives emulator
# ===============================
    include "L1Trigger/CSCTriggerPrimitives/data/cscTriggerPrimitiveDigis.cfi"
    # replace cscTriggerPrimitiveDigis.commonParam.isMTCC  = true
    # replace cscTriggerPrimitiveDigis.commonParam.isTMB07 = true
    replace cscTriggerPrimitiveDigis.alctParamMTCC2.verbosity = 2
    replace cscTriggerPrimitiveDigis.clctParamMTCC2.verbosity = 2
    replace cscTriggerPrimitiveDigis.tmbParam.verbosity       = 2
#- For cosmic data
    replace cscTriggerPrimitiveDigis.CSCComparatorDigiProducer = cscunpacker:MuonCSCComparatorDigi
    replace cscTriggerPrimitiveDigis.CSCWireDigiProducer       = cscunpacker:MuonCSCWireDigi

# CSC Trigger Primitives reader
# =============================
    include "L1Trigger/CSCTriggerPrimitives/test/CSCTriggerPrimitivesReader.cfi"
    replace lctreader.debug      = true
    replace lctreader.isMTCCData = false

# Auxiliary services
# ==================
#    service = Timing { }
#    service = SimpleMemoryCheck { }
#    service = EnableFloatingPointExceptions {}
#    service = Tracer {}

# Output
# ======
    module out = PoolOutputModule {
#	untracked string fileName = "/data0/slava/test/lcts_39924.root"
#	untracked string fileName = "/data0/slava/test/lcts_080428_164658.root"
#	untracked string fileName = "/data0/slava/test/lcts_080515_095949.root"
#	untracked string fileName = "/data0/slava/test/lcts_43434.root"
#	untracked string fileName = "/data0/slava/test/lcts_080528_190406.root"
	untracked string fileName = "/data0/slava/test/lcts_080609_103605.root"
	untracked vstring outputCommands = {
	    "keep *",
	    "drop *_DaqSource_*_*"
	}
    }

# scheduler path
# ==============
    path p = {cscunpacker, cscTriggerPrimitiveDigis, lctreader}
    endpath ep = {out}
}
